Root - суперпользователь с UID=0. Любой юзер с UID=0 будем считаться рутом.

Примеры привилегий рута:
- Создание файлов устройств
- Установка системных часов
- Повышение лимитов использования ресурсов и приоритетов процессов
- Изменение имени хоста системы
- Настройка сетевых интерфейсов
- Открытие сетевых портов с номерами <1024
- Выключение системы


**setuid** (Set User ID) и **setgid** (Set Group ID) — это специальные разрешения для файлов в Unix/Linux системах, главным образом для исполняемых файлов.

### setuid

- Помечает исполняемый файл.
- Когда пользователь запускает такой файл, процесс получает права владельца файла (обычно root).
- Используется, чтобы временно дать пользователю дополнительные привилегии.
- Пример: команда passwd имеет setuid-бит, чтобы обычный пользователь мог изменять свой пароль.

**Как установить:**
```shell
chmod u+s файл
```
В правах на файл появляется "s":  
`-rwsr-xr-x`

### setgid

- Также устанавливается на исполняемый файл.
- При запуске процесса он получает группу-владельца файла как основную группу процесса.
- Применяется для совместных каталогов: все новые файлы внутри каталога наследуют группу этого каталога.
- Для каталогов: новые файлы/подкаталоги получают группу-владельца каталога.

**Как установить:**

```shell
chmod g+s файл_или_каталог
```

В правах появляется "s" в позиции группы:  
`-rwxr-sr-x (файл)  `
`drwxrwsr-x (каталог)`

НО! setuid/setgid могут быть опасными, если их использовать на небезопасных файлах — это лазейка для атак (эскалация прав).

### Root

Под рутом не ведется журналирование, поэтому не узнать, кто вчера в 3 утра что и каким образом сломал. Также не логируется, кто из юзеров, имеющих доступ к руту, зашёл

### su

**su** ("substitute user" или "switch user") — команда в Unix/Linux, позволяющая запустить оболочку (или команду) от имени другого пользователя.

- Обычно используется для получения прав другого пользователя, чаще всего root (su по умолчанию переключает на root).
- Требует ввода пароля того пользователя, на которого переключаетесь.
- Можно указать имя пользователя:
`su username`
- С опцией **-** (или **-l**) входите с полной пользовательской средой (как при обычном входе в систему):
`su - username`
- Чтобы выйти из режима su — используйте exit.
#### Пример:

``` sh
su          # переход на root

su bob      # переход на пользователя bob

su - bob    # переход на bob + полная среда
```

**Разница с sudo:**  

su переключает вас полностью на другого пользователя, а sudo позволяет выполнять отдельные команды от имени другого пользователя (чаще root), обычно без смены окружения.

**su** обычно используется для открытия сессии от другого пользователя.

Команда su не фиксирует действия, производимые привилегированным пользователем, но добавляет запись в журнальный файл с указанием, кто и когда вошёл в систему как root.

Рекомендуется вызываться команду по абсолютному пути:
`
`/bin/su` или `/usr/bin/su`

### sudo

**sudo** (superuser do) — это команда в Unix/Linux, позволяющая запускать отдельные команды от имени другого пользователя (по умолчанию — root), не переключаясь полноценно на его сеанс.

- Благодаря введению журнала команд значительно улучшается учёт
- Пользователи могут выполнять определённые задачи, не имея при этом неограниченных прав root
- Реальный пароль root не нужно шарить между пользователями
- Использование sudo быстрее, чем su или вход в систему под рутом
- Привилегии можно отменить без изменения пароля root
- Уменьшается вероятность, что корневая оболочка останется без присмотра (каждые 5 минут перезапрос пароля пользвоателя)
- Права и возможности sudo настраиваются в одном файле – /etc/sudoers (менять через visudo для взятия лока)
- Можно запускать команды от имени любого пользователя:
`sudo -u username команда`

#### Примеры:

- Выполнить команду от root:
`sudo apt update`

- Открыть root-оболочку:
`sudo -i`

- Запустить команду от имени другого пользователя:
`sudo -u bob ls /home/bob`

#### Преимущества над su:

- Не нужно знать пароль root (администратор сам задаёт, какие команды разрешены конкретному пользователю).

- Можно ограничивать доступ к отдельным командам для разных пользователей.

- Улучшенное журналирование.

#### Пример файла sudoers

```sh
# Define aliases for machines in CS & Physics departments
Host_Alias CS = tigger, anchor, piper, moet, sigi
Host_Alias PHYSICS = eprince, pprince, icarus

# Define collections of commands
Cmnd_Alias DUMP = /sbin/dump, /sbin/restore
Cmnd_Alias WATCHDOG = /usr/local/bin/watchdog
Cmnd_Alias SHELLS = /bin/sh, /bin/dash, /bin/bash

# Permissions
mark, ed  PHYSICS = ALL
herb      CS = /usr/sbin/tcpdump : PHYSICS = (operator) DUMP
lynda     ALL = (ALL) ALL, !SHELLS
%wheel    ALL, !PHYSICS = NOPASSWD: WATCHDOG
```

Пользователи mark и ed на всех машинах из группы PHYSICS могут запускать **любые** команды с помощью sudo.

На всех машинах группы CS пользователь herb может запускать только команду /usr/sbin/tcpdump с помощью sudo.
На всех машинах группы PHYSICS пользователь herb может запускать команды из алиаса DUMP от имени пользователя operator.

Пользователь lynda на всех хостах (ALL) от имени любого пользователя ((ALL)) может запускать любые команды (ALL), **кроме** тех, что определены в алиасе SHELLS.  Но может скопировать в /tmp, например, и запустить.
То есть, нельзя запускать стандартные shell-команды через sudo.

Все пользователи из группы wheel на **всех хостах**, кроме хостов группы PHYSICS, могут запускать команду /usr/local/bin/watchdog через sudo **без запроса пароля**.

Привилегии определяются по последнему соответствию в файле sudoers.