#### Этап 1. Формирование ТЗ

Рассмотрим пример, когда к нам пришли с просьбой поднять "сервис о животных".

Сначала уточняем бизнес-требования, которые примерно такие:

- функционал (что хотим получить на старте, через 6 месяцев, что планируется через год)
- ожидаемый RPS
- количество 9999
- бюджет на весь этот движ

Ответы могут быть, к сожалению, следующие:

- А мы пока не знаем
- DAU 10K
- Чтобы всегда работал
- Чтобы было подешевле

DAU надо конвертировать в RPS, учитывая пиковые нагрузки, которые также могут зависеть от часовых поясов и географии аудитории, рекламных запусков, акций итд

Также с бизнесом стоит перетереть по 9999, глядя на следующую таблицу:

![[Pasted image 20250928153749.png]]

Нужно закладывать бюджет надежности на внештатные ситуации и технические работы. Достижение каждой следующей девятки экспоненциально сложнее по материальным затратам. Трех девяток для большинства сервисов хватает с головой.

Стоимость будет складываться из выбора архитектуры, кол-ва 9999, кол-ва AZ, кол-ва железа.

В конце общения с бизнесом должны прийти примерно к таким пунктам:

- Будет личный кабинет, подписки(биллинг), статьи
- RPS ~ 1
- 99,95% надежности
- 3 AZ, облако

--- 

#### Этап 2. Масштабируемость

**Масштабируемость** - свойство системы, которое позволяет наращивать мощности без даунтайма сервиса.

Стоит продумать:
- балансировку между бекендами - выбор алгоритма. RR(не учитывается нагруженность бека, тяжести запросов), least connection(не учитывается кол-во запросов), ip-hash и другие
- скейлинг (увеличение мощностей) - вертикальный скейлинг(сервер масштабирует свои ресурсы, "растёт вверх", плюсы - скорость скейлинга, не требует доработок, минусы - физические лимиты ресурсов), горизонтальный скейлинг(увеличение кол-ва серверов, кластер "растет вширь", плюсы - нет лимитов, кроме глобальных, минусы - нужны доработки, скорость скейлинга), репликация, шардирование БД
- монолит(латенси, дешевле по стоимости/ресурсам, легче тестировать) vs микросервисы(поддерживаемость, отказоустойчивость)
- капасити(нагрузочное тестирование, расчет ресурсов под минус-дц)

---

#### Этап 3. Отказоустойчивость

**Отказоустойчивая** система - когда пользователи не замечают разницы в работе приложения, которое переживает сбой.

Балансировка на точке входа:
- через DNS(легко настраивается, долго обновляется)
- через anycast(балансировка на сетевом оборудовании, когда разные AZ анонсируют один IP, плюсы - контролируемо, минусы - сами настраиваем сетевую инфру)
- через плавающий IP(один IP анонсируется на одну AZ, который перемещается между разными серверами, плюсы - можно реализовать без доп.сетей, минусы - возможен даунтайм при переключении, хосты без нагрузки)

Работа со сбоями:
- timeout
- exponential retry
- pumpkin
- контролируемая деградация
- защита от перегрузок(cpu limiter, rps limiter, captcha, caches)
- изоляция контуров(окружение, типы устройств, гео)

---

#### Этап 4. Наблюдаемость

**Наблюдаемая** система - та, о состоянии которой можно судить по графикам

Наблюдаемость - это:
- логи (loki/kibana)
- трейсы (opentelemetry)
- графики (grafana)
- метрики (prometheus)
- алёрты (grafana on call)

---

#### Этап 5. Поддерживаемость

Система **поддерживаема**, если она легкоуправляема целиком. Документация, техновстречи, отсутствие bus-фактора, простота. Учитывать тренды рынка.

