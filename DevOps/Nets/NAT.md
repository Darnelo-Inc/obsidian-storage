**NAT (Network Address Translation)** — это технология, которая позволяет менять IP-адреса в сетевых пакетах, проходящих через маршрутизатор.  
Применяется обычно для того, чтобы несколько устройств внутри сети с "приватными" адресами могли использовать один “общий” внешний (глобальный) IP для выхода в интернет.

---
### Зачем нужен NAT?

1. **Экономия публичных IP-адресов**: Публичных (глобальных) IP в мире мало, их не хватает всем. С помощью NAT сотни устройств в частной сети (например, дома или в офисе) используют один внешний IP.
2. **Безопасность**: Внутренняя сеть с приватными адресами (например, 192.168.x.x или 10.x.x.x) закрыта для внешнего мира — так проще защититься от атак.
3. **Упрощение администрирования**: Меняешь схему локальной сети — не надо менять что-то у провайдера.

---
### Как работает NAT?

Когда компьютер в локальной сети отправляет пакет в интернет:

1. Его пакет приходит на маршрутизатор (роутер).
2. Роутер подменяет IP-адрес отправителя на свой внешний (глобальный) IP, а информацию о том, с какого адреса и порта пришёл запрос, сохраняет у себя в специальной таблице.
3. Интернет-ресурс видит только адрес роутера.
4. Когда ответ приходит обратно, роутер смотрит в таблице — какой внутренний IP и порт ждал этот ответ — и передаёт пакет внутрь сети.

---
### Виды NAT

#### 1. **SNAT** (Source NAT)
Меняется исходный (source) адрес пакетов.  
Пример: подмена адреса локального компьютера на внешний адрес роутера для выхода в интернет.

#### 2. **DNAT** (Destination NAT)
Меняется адрес получателя (destination) в пакете.  
Пример: порт-форвардинг — когда внешний запрос по какому-то порту (например, 80) на роутер направляется на определённый внутренний сервер (например, 192.168.1.10:80).

#### 3. **Masquerading**
Частный случай SNAT для динамических (обычно PPPoE) адресов — роутер сам подставляет тот адрес, который ему дала сеть.

#### 4. **PAT** (Port Address Translation)
Также называют "NAT Overloading".  
Заменяется не только IP-адрес, но и порт отправителя.  
Это позволяет большому числу внутренних устройств использовать один внешний IP: роутер различает подключения по портам.

---
### Пример

Ваша домашняя сеть:
- Внутри: 192.168.0.2, 192.168.0.3, 192.168.0.4  
- Внешний IP вашего роутера: 92.123.45.67

Компьютер 192.168.0.2 отправляет запрос в интернет:
1. Пакет от 192.168.0.2 → 8.8.8.8 (Google DNS)
2. Ваш роутер меняет source IP с 192.168.0.2 на 92.123.45.67, меняет порт отправителя (если используется PAT).
3. To 8.8.8.8 выглядит так, будто бы запрос сделали с 92.123.45.67 (ваш роутер).
4. Ответ приходит на 92.123.45.67, роутер по таблице определяет, кому отправить — и передаёт пакет 192.168.0.2.

---
### Приватные (внутренние) адреса, обычно используемые с NAT:

- 10.0.0.0 — 10.255.255.255
- 172.16.0.0 — 172.31.255.255
- 192.168.0.0 — 192.168.255.255

---
### Недостатки NAT

- Не всё работает через NAT “прозрачно”, могут возникать проблемы с некоторыми протоколами (например, SIP/VoIP, P2P-игры).
- Не все входящие подключения снаружи доступны вашим внутренним устройствам (надо делать port forwarding).