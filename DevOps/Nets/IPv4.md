Internet Protocol обеспечивает передачу пакетов данных между компьютерами.
IP нужен, т.к. только с Ethernet фреймами данные не доставить всегда. Если хост A в одной Eth-сети, хост B - в другой, то кадр, выйдя из хоста А, будет отвергнут всеми хостами в этой сети(т.к. mac-адрес не совпадает с mac-адресом получателя) и никуда не дойдёт. Даже если как-то его отправить до провайдерского узла, в PPP-кадре нет адреса получателя.

Произвольные id каждому хосту не выдать, иначе бы таблицы маршрутизации были бы на миллиарды адресов - долго искать путь для каждого запроса, расход памяти. Поэтому сети сгруппировали и маршрутизаторы ищут пути по префиксам.

![[Pasted image 20251006010450.png|900]]
 
 Маршрутизаторы помогают передавать данные между подсетями. Чтобы передать данные от одного компьютера другому, нужно идентифицировать компьютер, чтобы понимать, куда передавать данные. Эта информация хранится в IP-адресе, заголовок которого добавляется к каждому сегменту, превращая его в пакет.

Заголовок IPv4

![[Pasted image 20251013223715.png]]
![[Pasted image 20251013223606.png|1200]]

**Differentiated Services Code Point (DSCP)**
Изначально называлось «тип обслуживания» (Type of Service, ToS), в настоящее время определяется [RFC 2474](https://datatracker.ietf.org/doc/html/rfc2474) как «Differentiated Services». Используется для разделения трафика на классы обслуживания, например, для установки чувствительному к задержкам трафику, такому как [VoIP](https://ru.wikipedia.org/wiki/VoIP "VoIP"), большего приоритета.


**Указатель перегрузки (Explicit Congestion Notification, ECN)**
Предупреждение о перегрузке сети без потери пакетов. Является необязательной функцией и используется, только если оба хоста её поддерживают.


**Идентификатор**
Преимущественно используется для идентификации фрагментов пакета, если он был фрагментирован.


**Флаги**
Поле размером три бита, содержащее флаги контроля над фрагментацией. Биты, от старшего к младшему, означают:
- 0: Зарезервирован, должен быть равен 0 [why](https://ru.wikipedia.org/wiki/IPv4#cite_note-13).
- 1: Не фрагментировать
- 2: У пакета ещё есть фрагменты

Если установлен флаг «не фрагментировать», то в случае необходимости фрагментации такой пакет будет уничтожен. Может использоваться для передачи данных хостам, не имеющим достаточных ресурсов для обработки фрагментированных пакетов.

Флаг «есть фрагменты» должен быть установлен в 1 у всех фрагментов пакета, кроме последнего. У нефрагментированных устанавливается в 0 — такой пакет считается собственным последним фрагментом.


**Смещение фрагмента**
Поле размером в 13 бит, указывает смещение поля данных текущего фрагмента относительно начала поля данных первого фрагментированного пакета в блоках по 8 байт. Позволяет задать до (213−1)×8=65528 байт смещения. При учёте размера заголовка итоговое смещение может превысить максимальный размер пакета (65528 + 20 = 65548 байт). Первый фрагмент в последовательности имеет нулевое смещение.


**Протокол**
Указывает, данные какого [протокола IP](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%BE%D0%B2,_%D0%B8%D0%BD%D0%BA%D0%B0%D0%BF%D1%81%D1%83%D0%BB%D0%B8%D1%80%D1%83%D0%B5%D0%BC%D1%8B%D1%85_%D0%B2_IP "Список протоколов, инкапсулируемых в IP") содержит пакет (например, TCP или ICMP). Присвоенные номера протоколов можно найти на сайте [IANA](https://ru.wikipedia.org/wiki/IANA "IANA")[[14]](https://ru.wikipedia.org/wiki/IPv4#cite_note-14).